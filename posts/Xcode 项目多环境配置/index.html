<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="Coder 灰桑"/><link rel="canonical" href="https://coder.linsyorozuya.com/posts/Xcode%20%E9%A1%B9%E7%9B%AE%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"/><meta name="twitter:url" content="https://coder.linsyorozuya.com/posts/Xcode%20%E9%A1%B9%E7%9B%AE%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"/><meta name="og:url" content="https://coder.linsyorozuya.com/posts/Xcode%20%E9%A1%B9%E7%9B%AE%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"/><title>Xcode 项目多环境配置 | Coder 灰桑</title><meta name="twitter:title" content="Xcode 项目多环境配置 | Coder 灰桑"/><meta name="og:title" content="Xcode 项目多环境配置 | Coder 灰桑"/><meta name="description" content="Stay Foolish, Always Foolish"/><meta name="twitter:description" content="Stay Foolish, Always Foolish"/><meta name="og:description" content="Stay Foolish, Always Foolish"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to Coder 灰桑"/></head><body class="item-page"><header><div class="wrapper"><a href="/" class="site-name">Coder 灰桑</a><p class="description">Stay Foolish, Always Foolish</p><nav><ul><li><a href="/">最新</a></li><li class="selected"><a href="/posts">Code</a></li><li><a href="/products">产品</a></li><li><a href="/about">关于</a></li></ul></nav></div></header><div class="wrapper"><article><h1>Xcode 项目多环境配置</h1><div class="metadata"><ul class="tag-list"><li class="tag variant-6"><a href="/tags/xcode">Xcode</a></li><li class="tag variant-0"><a href="/tags/ios">iOS</a></li></ul><span class="date">5月 31, 2021</span></div><div class="content"><h3>添加 Configuration</h3><p>1⃣️前往 Project - info - Configurations</p><p>2⃣️点击 + Duplicate 相应的 Configuration</p><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/skdasddd.png" alt="Configurations"/><h3>添加 Scheme</h3><p>1⃣️前往 Manage Scheme</p><p>2⃣️点击设置 Duplicate 相应的 Scheme</p><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/J9GJ4x.png" alt="Duplicate Scheme"/><p>3⃣️修改相应的 Build Configuration 为上一步创建的 Configuration</p><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/aoz1jy.png" alt="Build Configuration 修改"/><h3>配置 Bundle Id 生成不同的包</h3><p>1⃣️前往 TARGETS - Build Settings</p><p>2⃣️修改 Product Bundle Identifier 中 Configuration 相应的 Bundle Id</p><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/GqlVzG.png" alt="Bundle Id"/><h3>配置应用名称</h3><p>1⃣️前往 TARGETS - Build Settings</p><p>2⃣️顶部菜单 Editor - Add Build Setting 添加 User-Defined Setting</p><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/uQYWyX.png" alt="User-Defined Setting"/><p>3⃣️设置相应 Configuration 的应用名</p><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/35Vl2R.png" alt="应用名设置"/><p>4⃣️在 info.plist 中配置 Bundle display name 为上一步设置的参数</p><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/2Xc3RY.png" alt="Bundle display name"/><h3>在代码中根据 Configuration 配置相关数据</h3><p>1⃣️在 info.plist 中添加一个值： key：Configuration Value：$(CONFIGURATION)</p><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/IlrsxS.png" alt="$Configuration"/><p>2⃣️实现一个方法获取</p><pre><code><span class="keyword">class</span> BuildConfiguration {
    <span class="keyword">static let</span> shared = <span class="type">BuildConfiguration</span>()
    <span class="keyword">var</span> environment: <span class="type">Environment</span>
    
    <span class="keyword">var</span> baseURL: <span class="type">String</span> { <span class="comment">// 1</span>
        <span class="keyword">switch</span> environment {
        <span class="keyword">case</span> .<span class="dotAccess">debugStaging</span>, .<span class="dotAccess">releaseStaging</span>:
            <span class="keyword">return</span> <span class="string">"https://staging.example.com/api"</span>
        <span class="keyword">case</span> .<span class="dotAccess">debugDevelopment</span>, .<span class="dotAccess">releaseDevelopment</span>:
            <span class="keyword">return</span> <span class="string">"https://dev.example.com/api"</span>
        <span class="keyword">case</span> .<span class="dotAccess">debugProduction</span>, .<span class="dotAccess">releaseProduction</span>:
            <span class="keyword">return</span> <span class="string">"https://example.com/api"</span>
        }
    }
    
    <span class="keyword">init</span>() {
        <span class="keyword">let</span> currentConfiguration = <span class="type">Bundle</span>.<span class="property">main</span>.<span class="call">object</span>(forInfoDictionaryKey: <span class="string">"Configuration"</span>) <span class="keyword">as</span>! <span class="type">String</span>
        
        environment = <span class="type">Environment</span>(rawValue: currentConfiguration)!
    }
}

<span class="type">BuildConfiguration</span>.<span class="property">shared</span>.<span class="property">baseURL</span>
</code></pre><h2>xcconfig 概念及其作用</h2><p>一般修改 Build Setting 的办法是在 Xcode 的 Build Settings 界面上进行。手工修改容易出错，且不便于查找。 Xcode 提供了 Build configuration file（构建配置文件）来为 Project 或 Target 定义一组 Build Setting。也就是 xcconfig 的作用。使用 xcconfig 因为是纯文本所有非常容易查看修改了哪些配置不容易出错。</p><h3>xcconfig 优先级</h3><p>使用 xcconfig 时，Xcode 构建系统会按照下面的优先级来计算出 Build Setting 的最后生效值：</p><ul><li>Platform Defaults (平台默认值)</li></ul><ul><li>Xcode Project xcconfig File（Project 级别的 xcconfig 文件）</li></ul><ul><li>Xcode Project File Build Settings（Project 级别的手工配置的 Build Setting）</li></ul><ul><li>Target xcconfig File （Target 级别的 xcconfig 文件）</li></ul><ul><li>Target Build Settings（Target 级别的手工配置的 Build Setting）</li></ul><p>Xcode 构建系统会按照上述列表从上而下读取 Build Setting，如果发现同样的 Setting ，就会把下面的 Setting 覆盖掉上面的，越往下优先级别越高。</p><h3>格式和写法</h3><pre><code><span class="comment">/// 通过#include引入其他 xcconfig 文件</span>
#include <span class="string">"path/to/OtherFile.xcconfig"</span>

<span class="comment">/// xcconfig 中配置的格式 key = value</span>
<span class="type">BUILD_SETTING_NAME</span> = value

<span class="comment">/// 通过使用 $(inherited) 来保留原先的值</span> 
<span class="type">BUILD_SETTING_NAME</span> = $(inherited) additional value

<span class="comment">/// 引用其他已定义的 Build Setting</span>
<span class="type">FRAMEWORK_SEARCH_PATHS</span> = $(inherited) $(<span class="type">PROJECT_DIR</span>)
</code></pre><h3>xcconfig 分类</h3><p>可以把 xcconfig 文件分成三大类：Shared、 Project 和 Targets。</p><ul><li>Shared： 文件夹用于保存分享到整个 App 的 Build Setting，例如 Swift 的版本号、App 所支持的 iOS 版本号等各种共享的基础信息。</li></ul><ul><li>Project： 文件夹用于保存 Xcode Project 级别的 Build Setting，其中 BaseProject.xcconfig 会引入 Shared 文件夹下所有的 xcconfig 配置文件。</li></ul><ul><li>Targets： 文件夹用于保存 Xcode Target 级别的 Build Setting，也是由一个 BaseTarget.xcconfig 文件来共享所有 Target 都需要使用的信息。它们都需要引入 CocoaPods 所生成的 xcconfig 和共享的 BaseTarget.xcconfig 文件，然后根据需要改写 App 的名字。</li></ul><h3>xcoconfig 配置</h3><img src="https://cdn.jsdelivr.net/gh/linsyorozuya/Pics@master/uPic/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_22f5f19a-696d-4c20-acb6-940cc10f73bf.png" alt="配置图例子"/><p>参考： <a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=657&sid=20-h5Url-0&buyFrom=2&pageId=1pz4#/detail/pc?id=6656">配置准备：如何搭建多环境支持，为 App 开发作准备</a></p></div></article></div><div class="item-bottom-nav"><div><a href="/posts/揭开 SwiftUI 神秘面纱" class="item">🔙  揭开 SwiftUI 神秘面纱</a></div><div><a href="/posts/SwiftUI 如何监听 @State 变更" class="item">SwiftUI 如何监听 @State 变更  🔜</a></div></div><footer><p>Copyright © 2021 灰桑</p><p>Powered by <a href="https://github.com/johnsundell/publish">John Sundell's Publish</a></p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>